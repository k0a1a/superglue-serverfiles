server.modules = (
 "mod_access",
 "mod_cgi",
 "mod_accesslog",
 "mod_rewrite",
 "mod_alias",
 "mod_auth",
 "mod_setenv",
# "mod_status",
# "mod_debug"
)

server.document-root =  "/www/htdocs"
server.upload-dirs =  ( "/www/tmp" )
server.errorlog =       "/www/log/error.log"
accesslog.filename =    "/www/log/access.log"
server.pid-file =       "/var/run/lighttpd.pid"
server.username =       "httpd"
server.groupname =      "nogroup"
server.port =           80

#dir-listing.activate =   "enable"
#dir-listing.hide-dotfiles = "enable"

#debug.log-request-handling = "enable"
#debug.log-request-header = "enable"
#debug.log-file-not-found = "enable"
#debug.log-request-header-on-error = "enable"
#debug.log-response-header = "enable"
#debug.log-condition-handling	= "enable"
#auth.debug = 2

#setenv.add-response-header = ( "Access-Control-Allow-Origin" => "*" )

index-file.names = (
    "index.html",
    "default.html"
)

cgi.assign = (
    ".sh"   =>  "/bin/bash",
    ".cgi"  =>  "",
)

url.access-deny = ( "~", ".inc", ".htaccess", ".htpasswd", "htpasswd", "/tmp/" )

auth.backend = "htdigest"
auth.backend.htdigest.userfile = "/www/lib/htpasswd"
auth.require = (
  "/admin"  => (
    "method"  =>  "digest",
    "realm"   =>  "superglue",
    "require" =>  "valid-user"
  ),
  "/log"  => (
    "method"  =>  "digest",
    "realm"   =>  "superglue",
    "require" =>  "valid-user"
  ),
  "/server-status" => (
    "method"  =>  "digest",
    "realm"   =>  "superglue",
    "require" =>  "valid-user"
  )
)

$HTTP["request-method"] == "GET" {
  url.rewrite = (
    "^/resources/(.*)$" =>  "resources/$1",
    "^/devTools/(.*)$"  =>  "devTools/$1",
    "^/templates/(.*)$" =>  "templates/$1",
  ),
  alias.url = (
    "/resources"  =>  "/www/lib/resources",
    "/devTools"   =>  "/www/lib/devTools",
    "/extension"  =>  "/www/lib/extension",
    "/templates"  =>  "/www/lib/templates",
    "/admin"      =>  "/www/lib/cgi/admin.cgi"
  )
  ## override content and mime type for dotless files to text/html
  $HTTP["url"] !~ "(\.)" {
    setenv.add-response-header += (
      "X-Superglue-Dotless" => "text/html Content-Type was forced",
      "Content-Type" => "text/html"
    )
  }
}

$HTTP["request-method"] == "POST" {
  alias.url = (
    "/admin"    =>  "/www/lib/cgi/admin.cgi",
    ""          =>  "/www/lib/cgi/post.cgi"
  )
  auth.require = (
    "" => (
      "method"  =>  "digest",
      "realm"   =>  "superglue",
      "require" =>  "valid-user"
    )
  )
}

## reads optional conf files
include_shell "/etc/lighttpd/opts.sh mime.conf" # compress.conf
## defines var.superglueVersion from /etc/superglue_version
include_shell "/etc/lighttpd/vars.sh"
setenv.add-response-header = ( "X-Superglue-Version" => var.superglueVersion )
